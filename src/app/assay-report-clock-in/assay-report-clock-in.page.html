<app-common-header [pageSource]="'assay-report-clock-in'" [headerTitle]="'Assay Report'"></app-common-header>

<style>
  .form-title {
    font-size: 1.8em;
    font-weight: bold;
    text-align: center;
    margin-top: 20px;
    color: #444;
  }

  .input-group {
    margin: 15px 10px;
  }

  .input-label {
    font-weight: bold;
    margin-bottom: 5px;
    font-size: 1.1em;
    color: #555;
  }

  .input-field,
  ion-textarea {
    margin-bottom: 10px;
    border: 1px solid #ccc; /* Improved border style */
    border-radius: 5px; /* Rounded corners */
    padding: 10px; /* Padding inside the input */
    width: 100%;
  }

  ion-button.toggle-button {
    margin-top: 10px;
    --background: #007bff; /* Custom blue color for button */
    --color: white;
  }

  .upload-button {
    width: 100%;
    background-color: #007bff;
    color: white;
    font-weight: bold;
    border-radius: 5px;
  }

  .remarks-field {
    margin-top: 20px;
  }

  .deleteImageBtn {
    font-size: 16px;
    border-radius: 50%;
    background-color: red;
    color: white;
    padding: 5px;
    position: absolute;
    top: 5%;
    right: 3%;
    cursor: pointer;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    margin: 20px 0;
  }

  table th,
  table td {
    text-align: center;
    padding: 10px;
    border: 1px solid #ccc; /* Borders around cells */
  }

  table th {
    background-color: #f4f4f4; /* Light gray background for header */
    font-size: 1.1em;
    font-weight: bold;
  }

  table tbody tr:nth-child(even) {
    background-color: #f9f9f9; /* Zebra striping for rows */
  }

  .itemImage {
    width: 100px;
    height: 100px;
    object-fit: cover;
    margin: 5px;
  }

  ion-content {
    --padding-bottom: 80px; /* Ensure content doesn't overlap with the footer */
  }

  ion-footer {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background-color: #fff; /* White footer background */
    box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.1);
  }
</style>

<ion-content>

  <div class="input-group">
    <div class="input-label">Assay Company</div>
    <ion-select value="variation" interface="action-sheet" cancelText='Cancel' class="pickupselect"
                [(ngModel)]="assay_company_id">
      <ion-select-option *ngFor="let x of assayCompanyList"
                         value="{{x.assay_company_id}}">{{ x.title }}
      </ion-select-option>
    </ion-select>
  </div>

  <div class="input-group">
    <div class="input-label">Assay Report Date</div>
    <div class="selected-date">
      {{ assay_report_date ? (assay_report_date | date: 'dd/MM/yyyy HH:mm') : 'No date selected' }}
    </div>
    <ion-button expand="block" (click)="toggleCalendar()" class="toggle-button">
      {{ calendarVisible ? 'Close Calendar' : 'Open Calendar' }}
    </ion-button>
    <div *ngIf="calendarVisible">
      <ion-datetime
        display-format="dd/MM/yyyy HH:mm"
        picker-format="dd MMM yyyy HH:mm"
        [(ngModel)]="assay_report_date"
        placeholder="Select Date and Time"
        (ngModelChange)="onDateChange($event)">
      </ion-datetime>
    </div>
  </div>

  <div class="input-group">
    <div class="input-label">Status</div>
    <ion-radio-group [(ngModel)]="status">
      <ion-row>
        <ion-col>
          <ion-item>
            <ion-label>Assay Sample Collected</ion-label>
            <ion-radio slot="start" value="0" [disabled]="status!='3'"></ion-radio>
          </ion-item>
        </ion-col>
        <ion-col>
          <ion-item>
            <ion-label>Assay Report Received(partial)</ion-label>
            <ion-radio slot="start" value="1" [disabled]="true"></ion-radio>
          </ion-item>
        </ion-col>
        <ion-col>
          <ion-item>
            <ion-label>Assay Report Received</ion-label>
            <ion-radio slot="start" value="2" [disabled]="true"></ion-radio>
          </ion-item>
        </ion-col>
      </ion-row>
    </ion-radio-group>
  </div>

  <div class="input-group remarks-field">
    <div class="input-label">Remarks</div>
    <ion-textarea [(ngModel)]="remark" placeholder="Enter any remarks here"></ion-textarea>
  </div>

  <ion-grid>
    <ion-row>
      <ion-col size="12">
        <table>
          <thead>
          <tr>
            <th>No</th>
            <th>PW Barcode</th>
            <th>Weight</th>
            <th>Purity</th>
            <th>XAU</th>
            <th>Action</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let item of detailList; let i = index">
            <td>{{i+1}}</td>
            <td>
              <ion-select value="variation" interface="action-sheet" cancelText='Cancel' class="pickupselect"
                          [(ngModel)]="item.pw_barcode_id" required>
                <ion-select-option *ngFor="let x of pwBarcodeList"
                                   value="{{x.id}}">{{ x.title }}
                </ion-select-option>
              </ion-select>
            </td>
            <td><ion-input [(ngModel)]="item.weight" placeholder="Enter Weight(g)" type="number" (ionBlur)="caculateXAU(item)" required></ion-input></td>
            <td><ion-input [(ngModel)]="item.purity" placeholder="Enter purity" type="number" (ionBlur)="caculateXAU(item)" required></ion-input></td>
            <td><ion-input [(ngModel)]="item.xau" type="number" disabled required></ion-input></td>
            <td>
              <ion-row class="ion-align-items-center">
                <ion-col>
                  <ion-button class="upload-button" (click)="openActionSheetForItem(item)">
                    <ion-icon name="camera-outline"></ion-icon>
                  </ion-button>
                </ion-col>
                <ion-col>
                  <ion-button class="delete-button" (click)="removeItem(item)">
                    <ion-icon name="trash-outline"></ion-icon>
                  </ion-button>
                </ion-col>
              </ion-row>
              <div *ngIf="item.is_loading == true" class="loading-icon">
                <ion-spinner></ion-spinner>
              </div>
              <ion-slides pager="true">
                <ion-slide *ngIf="item.attachment">
                  <div class="image-slide-content">
                    <img [src]="item.attachment" class="itemImage">
                    <button (click)="deleteImage(item)" class="deleteImageBtn">x</button>
                  </div>
                </ion-slide>
              </ion-slides>
            </td>
          </tr>
          </tbody>
        </table>
      </ion-col>
    </ion-row>
  </ion-grid>
  <ion-button class="add-button" expand="block" (click)="addItem()">Add Item</ion-button>

</ion-content>

<ion-footer>
  <ion-button class="submit-button" expand="block" (click)="submitAssayReportPurity()" [disabled]="!isFormValid()">Submit</ion-button>
</ion-footer>
