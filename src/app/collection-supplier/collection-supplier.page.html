<app-common-header [pageSource]="'collection'" [headerTitle]="'Supplier List'"></app-common-header>

<ion-content class="ordelist ion-padding-top">

  <ion-progress-bar *ngIf="isLoading" type="indeterminate" color="primary"></ion-progress-bar>

	<ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
		<ion-refresher-content></ion-refresher-content>
	</ion-refresher>

  <ion-row>
    <ion-col size="10">
      <ion-searchbar [(ngModel)]="searchCustomerText" placeholder="Search Customer Name"></ion-searchbar>
    </ion-col>
    <ion-col size="2">
      <button type="button" style="padding: 10px 5px 10px 5px; margin-top:10px; background-color: #3276b1; border-radius: 10px; color: white;" (click)="searchCustomerText ='';selectedCustomer = '';getSupplierList()">Reset</button>
    </ion-col>
  </ion-row>


  <h3 style="margin-top: 5px; margin-left: 12px;font-weight: 600;">Select a Customer</h3>
  <ion-select value="variation" interface="action-sheet" cancelText='Cancel' class="pickupselect"
              [(ngModel)]="selectedCustomer" (ngModelChange)="getSupplierList();">
    <ion-select-option *ngFor="let x of customerList | search: searchCustomerText"
                       value="{{x.customer_id}}">{{x.name}}
    </ion-select-option>
  </ion-select>

	<ion-row class="ion-align-items-center">
		<ion-col size="12">
			<h5 style="margin-top: 5px; margin-left: 12px;font-weight: 600;">Total Customer: {{supplierList?.length}}
			</h5>
		</ion-col>
	</ion-row>

  <div>
    <div class="eachSupplier"
    *ngFor="let item of supplierList; let i = index;"
    >
    <div>

        <h3><span [routerLink]="['/grn/'+item.latest_po_id]">{{item.name}}</span> &nbsp;<ion-badge color="danger" id="total_po_to_be_collected_thisround">{{item.po_count}}</ion-badge>&nbsp;<ion-badge *ngIf="item.pending_po > 0" color="primary" id="pending_po_to_be_collected">+{{item.pending_po}}</ion-badge></h3>

        <ion-popover trigger="total_po_to_be_collected_thisround" triggerAction="click">
          <ng-template>
            <ion-content class="ion-padding">The total PO that you need to collect this round</ion-content>
          </ng-template>
        </ion-popover>

        <ion-popover trigger="pending_po_to_be_collected" triggerAction="click">
          <ng-template>
            <ion-content class="ion-padding">The total Pending PO of this customer, that may need to collect in the future</ion-content>
          </ng-template>
        </ion-popover>

        <span class="label" *ngIf="item.urgency_level > 0">{{item.urgency_level}}</span>
        <ion-grid [routerLink]="['/grn/'+item.latest_po_id]">
          <ion-row>
            <ion-col size="4"> Total XAU </ion-col>
            <ion-col>  <strong>{{item.total_XAU | number :'.3'}}</strong> </ion-col>
          </ion-row>
          <ion-row>
            <ion-col size="4">  Total AMT </ion-col>
            <ion-col>  <strong>{{item.total_amount | number :'.2'}}</strong> </ion-col>
          </ion-row>
          <ion-row>
            <ion-col size="4">  Pmt Methd </ion-col>
            <ion-col>  {{item.payment_method}} </ion-col>
          </ion-row>
        </ion-grid>


        <div class="label" [routerLink]="['/grn/'+item.latest_po_id]">{{item.remarks}}</div>

        <hr/>
        <div><button class="btn" (click)="item.is_expand=!item.is_expand">Show Details</button></div>
    </div>
    <div *ngIf="item.is_expand">

      <div style="margin-top:10px;">
        <div *ngIf="item['paymentMethodList']['Cash']['total_amount'] > 0">
          Cash <br/>
          <ion-progress-bar [value]="item['paymentMethodList']['Cash']['percentage']"></ion-progress-bar>
        </div>

        <div *ngIf="item['paymentMethodList']['Bank Transfer']['total_amount'] > 0">
          Bank Transfer <br/>
          <ion-progress-bar [value]="item['paymentMethodList']['Bank Transfer']['percentage']"></ion-progress-bar>
        </div>
      </div>

    <p>{{item.full_address}}</p>
    <p>Item List:</p>
    <table class="table" cellpadding="5" cellspacing="0" border="1">
      <thead>
        <tr>
          <th>ITEM</th>
          <th>g</th>
          <th>%</th>
          <th>XAU</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let i2 of item.itemList">
          <td>{{i2.gold_name}}</td>
          <td>{{i2.gram | number :'.2'}}</td>
          <td>{{i2.gold_pure_percent}}</td>
          <td>{{i2.XAU_amount | number :'.3'}}</td>
        </tr>
      </tbody>
    </table>
    <ion-grid class="itemList">

        <ion-row class="buttonaction">
          <ion-col size="2">
            <a class="wazebtn" target="_blank"
              href="https://waze.com/ul?q={{item.address1}},{{item.address2}},{{item.city}},{{item.postcode}}">
              <img src="../../assets/waze.png"></a>
          </ion-col>

          <ion-col size="2">
            <a class="googlemapbtn" target="_blank"
              href="http://maps.google.com/?q={{item.address1}},{{item.address2}},{{item.city}},{{item.postcode}}"><img
                src="../../assets/google-maps.png"></a>
          </ion-col>

          <ion-col size="2">
            <a class="whatsappbtn" target="_blank"
              href="https://api.whatsapp.com/send/?phone={{item.dial_code}}{{item.mobile}}&text=Dear+Valued+Customer%2C+RIDER+will+be+picking+up+your+order+within+30min-1hours%2C+pls+standby+phone+call+and+whatsapp&app_absent=0">
              <ion-icon name="logo-whatsapp"></ion-icon>
            </a>
          </ion-col>

          <ion-col size="2">
            <a target="_blank" class="callbtn" href="tel:{{item.mobile}}">
              <ion-icon name="call"></ion-icon>
            </a>
          </ion-col>
        </ion-row>
      </ion-grid>
      </div>


    </div>
  </div>




	<!--
<ion-row style="width:100%;">
    <ion-col size="12" class="ion-text-center">
      <div class="noitemincart ion-margin-top">
        <img src="../../assets/gg-icon/attention-icon.svg" style="width: 100px;">
        <h2 class="" style="color: #1A1A1A; font-weight: 600;">No any location</h2>
      </div>
    </ion-col>
  </ion-row>
-->

	<!-- <ion-list> -->
	<!-- <ion-col size="4" style="padding: 5px;">
            <ion-item (click)="searchWishList()" lines="none" class="ion-no-padding">
            <img src="../../assets/add-icon.svg" style="margin-top: 2px; width: 100%;">
            </ion-item>
        </ion-col>    -->

	<!-- </div> -->
	<div class="spacer" style="height: 40px"></div>
</ion-content>

<mytab></mytab>
